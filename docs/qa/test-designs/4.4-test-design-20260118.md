# Test Design: Story 4.4 Historical Trend Charting

Date: 2026-01-18
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 9
- Unit tests: 3 (33%)
- Integration tests: 4 (45%)
- E2E tests: 2 (22%)
- Priority distribution: P0: 4, P1: 4, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1 & AC3: UI Controls & Transitions

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 4.4-UNIT-001 | Unit | P1 | Time range selector state | Verifies the selector emits the correct events and updates local Vue state. |
| 4.4-INT-001 | Integration | P0 | SSE Pause/Resume | Verifies that the SSE event listener is disconnected when entering historical mode and reconnected on return to "Live". |
| 4.4-E2E-001 | E2E | P1 | Loading state UX | Verifies that a spinner/skeleton appears during data fetch to prevent a "frozen" UI. |

### AC2: Data Source Switching

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 4.4-UNIT-002 | Unit | P0 | Resolution mapping logic | Logic test: `1h -> raw`, `24h -> 1m`, `7d -> 5m`. |
| 4.4-INT-002 | Integration | P0 | Historical API Fetch | Verifies the service layer calls the correct backend endpoint with the expected `resolution` and `range` parameters. |
| 4.4-INT-003 | Integration | P1 | Chart Data Merging | Verifies the chart component correctly handles the transition from a streaming buffer to a static array. |

### AC4: Alert Markers Overlay

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 4.4-UNIT-003 | Unit | P1 | Alert annotation positioning | Logic test: Calculates correct X-axis pixel/index for a given alert timestamp. |
| 4.4-INT-004 | Integration | P2 | Alert history overlay | Verifies that alert history data is fetched and passed to the Chart.js annotation plugin. |

### Performance & Scale

#### Scenarios

| ID | Level | Priority | Test | Justification |
| :--- | :--- | :--- | :--- | :--- |
| 4.4-E2E-002 | E2E | P0 | 7-Day Rendering Performance | Performance test: Measure TTI (Time to Interactive) and frame rate when rendering 2,000+ points on 10 charts. |

## Risk Coverage (Reference: 4.4-risk-20260118.md)

| Risk ID | Mitigation Test(s) |
| :--- | :--- |
| PERF-007 (Rendering Lag) | 4.4-E2E-002 |
| TECH-005 (SSE Conflict) | 4.4-INT-001 |
| BUS-002 (Marker Clutter) | 4.4-INT-004 (Visual check) |

## Recommended Execution Order

1. **4.4-UNIT-002**: Validate mapping logic.
2. **4.4-INT-001, 002**: Validate the core data-fetching and SSE control logic (P0).
3. **4.4-E2E-002**: Performance check early to avoid architecture rework.
4. **4.4-UNIT-003, 4.4-INT-004**: Alert overlay features.
5. **4.4-E2E-001**: Final UX polish verification.
