# Risk Profile: Story 3.4.multi-agent-management-view

Date: 2026-01-18
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 1
- Risk Score: 73/100

## High Risks Requiring Attention

### 1. SEC-001: Tenant Isolation Breach via Agent ID

**Score: 6 (High)**
**Probability**: Medium (2) - Standard implementation of filtering by `agent_id` often misses explicit tenant ownership checks if not enforced at the model or global scope level.
**Impact**: High (3) - Unauthorized access to metric data from other tenants' agents is a significant security violation.
**Mitigation**:
- Implement strict tenant-agent ownership validation in the `DashboardController`.
- Use Eloquent relationships (e.g., `$tenant->agents()->find($agentId)`) to ensure scoping.
**Testing Focus**: 
- Negative testing: Attempt to access agent metrics for an `agent_id` belonging to a different tenant.
- Verify that the SSE stream also enforces tenant-based filtering.

## Risk Distribution

### By Category

- Security: 1 risk (1 high)
- Performance: 2 risks (0 critical)
- Data: 1 risk (0 critical)
- Operational: 1 risk (0 critical)

### By Component

- Frontend: 2 risks
- Backend: 2 risks
- Infrastructure/Data: 1 risk

## Detailed Risk Register

| Risk ID  | Description                                      | Probability | Impact     | Score | Priority |
| -------- | ------------------------------------------------ | ----------- | ---------- | ----- | -------- |
| SEC-001  | Tenant isolation breach via `agent_id` parameter | Medium (2)  | High (3)   | 6     | High     |
| PERF-001 | Slow DB aggregation with `MAX(timestamp)`        | Medium (2)  | Medium (2) | 4     | Medium   |
| PERF-002 | UI stutter with multiple real-time charts        | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-001 | Metric name mismatch (Go agent vs Frontend)      | Medium (2)  | Medium (2) | 4     | Medium   |
| OPS-001  | False offline status due to network latency      | Medium (2)  | Low (1)    | 2     | Low      |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (Security)

- **Scenario SEC-001.1**: Authenticated Tenant A requests metrics for Agent B (belonging to Tenant B).
- **Expectation**: 403 Forbidden or 404 Not Found.
- **Scenario SEC-001.2**: SSE stream subscription for Tenant A.
- **Expectation**: Only metrics for Tenant A's agents are pushed, even if Agent B is sending data.

### Priority 2: Medium Risk Tests (Performance & Data)

- **Scenario PERF-001.1**: Load test `DashboardController` list with 100+ agents and 1,000,000+ metric rows.
- **Scenario PERF-002.1**: Open Tenant Detail page on a mobile device and observe frame rate during real-time updates.
- **Scenario DATA-001.1**: Verify Go agent metrics (`cpu.usage.percent`, etc.) map correctly to chart labels.

### Priority 3: Low Risk Tests (Operations)

- **Scenario OPS-001.1**: Simulate 61-second delay in agent heartbeat.
- **Expectation**: Status changes to Offline. Verify it recovers instantly on next message.

## Risk Acceptance Criteria

### Must Fix Before Production

- SEC-001: Mandatory tenant ownership validation.
- DATA-001: Verified mapping of all three core metrics.

### Can Deploy with Mitigation

- PERF-001: If query time is < 200ms with current data volume.
- PERF-002: If UI remains responsive on target desktop browsers.

## Monitoring Requirements

- Track `MAX(timestamp)` query performance in Laravel logs.
- Monitor SSE connection stability and drop-off rates.
- Alert on "All Agents Offline" for a tenant to detect system-wide MQTT issues.

## Risk Review Triggers

- Change in DB schema for metrics.
- Increase in expected agent density per tenant (>50 agents).
- Introduction of new high-frequency metrics.
