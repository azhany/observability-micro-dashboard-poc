# Test Design: Story 2.4.e2e-smoke-test

Date: 2026-01-18
Designer: Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios**: 3
- **Unit tests**: 0 (0%) - *Not applicable for this orchestration/setup story*
- **Integration tests**: 0 (0%) - *Covered by previous stories*
- **E2E tests**: 3 (100%) - *Focus on full system validation*
- **Priority distribution**: P0: 2, P1: 1, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: Playwright BDD scenario "Ingest -> Chart"

#### Scenarios

| ID          | Level | Priority | Test                                        | Justification                                                                                   | Mitigates Risks |
| ----------- | ----- | -------- | ------------------------------------------- | ----------------------------------------------------------------------------------------------- | --------------- |
| 2.4-E2E-001 | E2E   | P0       | Validate metric ingestion to chart update   | Verifies the core value proposition and full data flow (Ingest -> DB -> SSE -> Frontend).       | PERF-001        |

### AC2: Runs in containerized environment

#### Scenarios

| ID          | Level | Priority | Test                                        | Justification                                                                                   | Mitigates Risks |
| ----------- | ----- | -------- | ------------------------------------------- | ----------------------------------------------------------------------------------------------- | --------------- |
| 2.4-E2E-002 | E2E   | P0       | Execute tests via `docker exec`             | Ensures the test infrastructure is correctly configured within the CI/CD-like container setup.  | TECH-001        |

### AC3: Handles async SSE/background jobs

#### Scenarios

| ID          | Level | Priority | Test                                        | Justification                                                                                   | Mitigates Risks |
| ----------- | ----- | -------- | ------------------------------------------- | ----------------------------------------------------------------------------------------------- | --------------- |
| 2.4-E2E-003 | E2E   | P1       | Assert chart update with dynamic waiting    | Validates that the test code correctly handles the asynchronous nature of SSE without flakiness.| TECH-002        |

## Risk Coverage

- **PERF-001 (Flaky Latency)**: Covered by `2.4-E2E-001` which includes the timing assertion.
- **TECH-001 (Container Setup)**: Covered by `2.4-E2E-002` confirming execution in the container.
- **TECH-002 (SSE Stability)**: Covered by `2.4-E2E-003` via robust wait mechanisms.

## Recommended Execution Order

1. **2.4-E2E-002 (Container Setup)**: First ensure the environment works.
2. **2.4-E2E-001 (Core Flow)**: Verify the happy path works.
3. **2.4-E2E-003 (Async Handling)**: Verify robustness (implicitly part of 001, but specific focus on the wait logic).

## Notes
- Since this is a "test infrastructure" story, the "tests" are actually the deliverables themselves.
- The distinction between 001 and 003 is logical; in practice, they are likely the same test script, but 003 represents the *quality* of that script (robustness).
