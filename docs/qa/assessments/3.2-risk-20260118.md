# Risk Profile: Story 3.2

Date: 2026-01-18
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 0
- High Risks: 1
- Risk Score: 71/100

## High Risks Requiring Attention

### 1. DATA-001: CPU Metric Accuracy (Initial Zero Value)

**Score: 6 (High)**
**Probability**: High - `gopsutil`'s `Percent` function requires a duration or a previous state; the first call in a loop often returns 0.0 or incorrect data if not handled.
**Impact**: Medium - Dashboard will show incorrect/missing data for the first interval, affecting initial visibility after agent restart.
**Mitigation**:
- Implement a "warm-up" collection cycle during agent startup.
- Use a short non-zero interval for the initial CPU check if necessary.
**Testing Focus**: Verify that the first JSON output contains a non-zero CPU value (assuming system activity).

## Risk Distribution

### By Category

- **Technical**: 2 risks (0 high)
- **Security**: 1 risk (0 high)
- **Performance**: 1 risk (0 high)
- **Data**: 1 risk (1 high)
- **Business**: 0 risks
- **Operational**: 1 risk (0 high)

### By Component

- **Agent (Go)**: 6 risks

## Detailed Risk Register

| Risk ID | Description | Probability | Impact | Score | Priority |
| :--- | :--- | :--- | :--- | :--- | :--- |
| DATA-001 | CPU Metric Initial 0 Value | High (3) | Medium (2) | 6 | High |
| TECH-001 | OS Metric Inconsistency (Darwin/Linux) | Medium (2) | Medium (2) | 4 | Medium |
| PERF-001 | Collection Ticker Blocking | Medium (2) | Medium (2) | 4 | Medium |
| BUS-001 | JSON Schema Drift (Future Backend) | Medium (2) | Medium (2) | 4 | Medium |
| SEC-001 | Excess Privileges (Root requirement) | Low (1) | Medium (2) | 2 | Low |
| OPS-001 | Config Validation (Invalid Interval) | Medium (2) | Low (1) | 2 | Low |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (DATA-001)
- **Startup Accuracy**: Verify metrics are non-zero/valid immediately upon first output.
- **Interval Validation**: Verify metrics are collected exactly at the configured interval without drift.

### Priority 2: Medium Risk Tests (TECH-001, PERF-001, BUS-001)
- **Linux Validation**: Execute the binary on a Linux target (via Docker) to ensure `gopsutil` returns expected disk and memory units.
- **Mock Slow Collectors**: Simulate a slow disk/CPU read to ensure it doesn't block other collectors or the ticker loop.
- **Schema Validation**: Validate JSON output against the `Metric` struct defined in `architecture/5-api-specification-rest-ingestion.md`.

### Priority 3: Low Risk Tests (SEC-001, OPS-001)
- **Least Privilege**: Run the agent as a non-root user and document which metrics fail (if any).
- **Chaos Config**: Provide string values to `COLLECTION_INTERVAL` and verify the agent uses defaults or exits gracefully.

## Risk Acceptance Criteria

### Must Fix Before Production
- DATA-001 (CPU Metric Accuracy)
- BUS-001 (Schema alignment with backend)

### Can Deploy with Mitigation
- TECH-001 (Provided it's verified in Docker/Linux)
- PERF-001 (With a documented limitation on interval vs collection time)

## Monitoring Requirements
- Agent resource usage (CPU/Mem) during collection cycles.
- Success/Failure logs for individual collectors (CPU, Mem, Disk).

## Risk Review Triggers
- Addition of new collectors (e.g., Network, Process list).
- Significant changes to the `Metric` data model in the backend.
