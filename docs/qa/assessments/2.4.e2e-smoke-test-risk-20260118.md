# Risk Profile: Story 2.4.e2e-smoke-test

Date: 2026-01-18
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 1
- Risk Score: 76/100

## High Risks Requiring Attention

### 1. PERF-001: Flaky Latency Assertion

**Score: 6 (High)**
**Probability**: High - The 500ms target for a full end-to-end roundtrip (Ingest -> Database -> SSE -> UI) is extremely tight for a containerized development/CI environment where resource contention is common.
**Impact**: Medium - Frequent false negatives will lead to "test fatigue" where developers ignore failures, undermining the value of the smoke test.
**Mitigation**:
- Implement a "warm-up" phase for the test.
- Use a slightly higher threshold for the assertion in CI vs local, or allow for a configurable tolerance.
- Ensure the test uses high-precision timing (e.g., performance.now()).
**Testing Focus**: Benchmark the actual latency in the target environment before finalizing the assertion threshold.

## Risk Distribution

### By Category

- Technical: 2 risks (0 critical)
- Performance: 1 risk (0 critical)
- Data: 1 risk (0 critical)
- Operational: 1 risk (0 critical)

### By Component

- Frontend: 2 risks
- Backend: 1 risk
- Infrastructure: 2 risks

## Detailed Risk Register

| Risk ID  | Description                          | Probability | Impact     | Score | Priority |
| -------- | ------------------------------------ | ----------- | ---------- | ----- | -------- |
| PERF-001 | Flaky 500ms latency assertion        | High (3)    | Medium (2) | 6     | High     |
| TECH-001 | Containerized Playwright complexity  | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-002 | SSE Connection Stability             | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-001 | Tenant/Auth Pre-requisites failure   | Low (1)     | Medium (2) | 2     | Low      |
| OPS-001  | CI Resource Exhaustion               | Medium (2)  | Low (1)    | 2     | Low      |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (PERF-001)
- **Scenario**: Repeated execution of the smoke test under varied load to determine the distribution of latencies.
- **Type**: Performance/Stability.
- **Requirement**: Use a CI-like environment for these benchmarks.

### Priority 2: Technical Setup (TECH-001, TECH-002)
- **Scenario**: Verify Playwright can run headlessly and reliably capture SSE events in the `docker-compose` environment.
- **Type**: Infrastructure/Smoke.

### Priority 3: Functional & Data (DATA-001)
- **Scenario**: Ensure clean state management (tenant creation/cleanup) so tests are idempotent.
- **Type**: Functional.

## Risk Acceptance Criteria

### Must Fix Before Production
- Reliable Playwright execution in the standard build pipeline.
- Stable SSE event detection (no missed events).

### Can Deploy with Mitigation
- The 500ms latency assertion can be initially advisory or have a wider tolerance (e.g., 1000ms) if 500ms proves consistently flaky in CI.

### Accepted Risks
- Minor CI slowdown due to browser overhead.

## Monitoring Requirements
Post-deployment monitoring for:
- E2E test failure rates (specifically looking for flakiness).
- Actual Ingest-to-UI latency metrics from production telemetry.

## Risk Review Triggers
Review and update risk profile when:
- Moving from PoC to production-grade infrastructure.
- Major changes to the SSE implementation or chart rendering logic.
