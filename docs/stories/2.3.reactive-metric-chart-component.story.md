# Story 2.3: Reactive Metric Chart Component (Live Mode)

## Status
Ready for Development

## Story
**As a** System Operator,
**I want** to see metrics visualized on a live-updating line chart,
**so that** I can observe trends in real-time.

## Acceptance Criteria
1. A reusable Vue 3 chart component (e.g., using Chart.js or ApexCharts) is implemented.
2. The component listens to the SSE stream and updates its data points without a full re-render.
3. The chart supports a "Live" mode indicator (e.g., a pulsing red dot).
4. Performance is optimized to handle high-frequency updates (e.g., 1 update/sec) without lag.

## Tasks / Subtasks
- [ ] Task 1: Install Dependencies (AC: 1)
    - [ ] Add `chart.js` to `app/package.json`.
    - [ ] Run `npm install`.
- [ ] Task 2: Implement Stream Service (AC: 2, 4)
    - [ ] Create `app/resources/js/Services/StreamService.ts`.
    - [ ] Implement `connect(tenantId)` using `EventSource`.
    - [ ] Implement event dispatching/subscription mechanism (e.g., `on(event, callback)`).
    - [ ] Handle connection lifecycle (connect, disconnect, error handling).
    - [ ] Ensure only one connection per tenant is active.
- [ ] Task 3: Create Realtime Chart Component (AC: 1, 2, 3, 4)
    - [ ] Create `app/resources/js/Components/RealtimeChart.vue`.
    - [ ] Use `Chart.js` to render a line chart.
    - [ ] Props: `tenantId`, `metricName`, `label`, `color`.
    - [ ] On mount, subscribe to `StreamService` for the specific `metricName`.
    - [ ] On data received: `chart.data.datasets[0].data.push()` and `chart.update('none')` for performance.
    - [ ] Limit data points (e.g., keep last 50 points) to prevent memory leaks.
    - [ ] Implement "Live" indicator (pulsing red dot) in the top corner of the widget.
- [ ] Task 4: Integration Verification (AC: 2)
    - [ ] Add the component to a temporary test page or existing dashboard page to verify it receives data.
    - [ ] Verify 60FPS performance during updates.

## Dev Notes
- **Previous Story Insights**:
    - SSE Endpoint: `/api/v1/stream/{tenant}`. [Source: Story 2.2]
    - Data format from SSE: JSON payload. [Source: Story 2.2]
- **Tech Stack**:
    - **Frontend**: Vue 3.4, TypeScript, Tailwind CSS. [Source: docs/architecture/3-tech-stack.md]
    - **Charting**: Chart.js (implied by "Chart.js" in AC and "Update Chart.js" in Core Workflows). [Source: docs/architecture/6-core-workflows.md]
- **Architecture**:
    - **Project Structure**: Components in `app/resources/js/Components` (Standard Laravel/Inertia), Services in `app/resources/js/Services`. [Source: docs/architecture/9-unified-project-structure.md]
    - **Data Flow**: SSE Controller -> Stream Service -> Chart Component. [Source: docs/architecture/6-core-workflows.md]
- **Performance**:
    - Target: < 100ms from DB to Browser. [Source: docs/architecture/10-security-and-performance.md]
    - Dashboard FPS: 60 FPS. [Source: docs/architecture/10-security-and-performance.md]
    - Optimization: Use non-reactive arrays for Chart.js data if possible, or careful Vue reactivity to avoid deep watchers on large datasets. Use `chart.update('none')` (mode: none) for smooth animations.
- **File Locations**:
    - `app/resources/js/Services/StreamService.ts`
    - `app/resources/js/Components/RealtimeChart.vue`

### Testing
- **Test Strategy**:
    - **Unit Tests**: Test `StreamService` connection logic (mock `EventSource`).
    - **Component Tests**: Mount `RealtimeChart.vue`, mock `StreamService`, emit event, assert Chart update (might be hard to test Chart.js canvas, check internal data or wrapper calls).
    - **Manual Verification**: Since this is a UI component, visual verification of the "Live" indicator and smooth updates is key.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2026-01-18 | 1.0 | Initial Story Draft | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_TBD_

### Debug Log References
_TBD_

### Completion Notes List
_TBD_

### File List
_TBD_

## QA Results
_TBD_