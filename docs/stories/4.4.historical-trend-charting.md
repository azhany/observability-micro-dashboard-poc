# Story 4.4: Historical Trend Charting

## Status
Ready for Development

## Story
**As a** System Operator,
**I want** to toggle my dashboard charts to show 1-hour, 24-hour, and 7-day views,
**so that** I can perform root cause analysis using historical data.

## Acceptance Criteria
1. Chart components are updated to support a "Time Range" selector.
2. Selecting a range > 1 hour automatically switches the data source from the SSE stream/raw table to the 1m or 5m rollup tables.
3. The UI provides a seamless transition between "Live" and "Historical" modes.
4. Alert markers (e.g., red vertical lines) are overlaid on the chart where state transitions occurred.

## Tasks / Subtasks
- [ ] **Chart Component Enhancement** (AC: 1, 3)
    - [ ] Add `TimeRangeSelector` component to the dashboard.
    - [ ] Update `MetricChart` component to handle static data arrays in addition to live SSE updates.
    - [ ] Logic to "pause" SSE updates when in historical mode.
- [ ] **Data Fetching Logic** (AC: 2)
    - [ ] Implement `fetchHistoricalMetrics` in the Vue service layer.
    - [ ] Mapping:
        - 1h -> `resolution=raw` or `resolution=1m`
        - 24h -> `resolution=1m`
        - 7d -> `resolution=5m`
- [ ] **Alert Overlay Implementation** (AC: 4)
    - [ ] Fetch alert history for the selected time range.
    - [ ] Use Chart.js annotation plugin (or equivalent) to draw vertical lines/markers at alert transition points.
- [ ] **UI/UX Polishing** (AC: 3)
    - [ ] Ensure smooth transitions (loading states) when switching ranges.
    - [ ] Clear "Historical" vs "Live" indicator. [Source: Story 2.3]

## Dev Notes
### Architecture References
- **Frontend Framework**: Vue 3 with Chart.js. [Source: architecture/3-tech-stack.md]
- **Unified Project Structure**: UI components located in `app/resources/js/components/ui/`. [Source: architecture/9-unified-project-structure.md]

### File Locations
- Vue Components: `app/resources/js/components/`
- API Services: `app/resources/js/services/metricService.js` (suggested)
- Dashboard Pages: `app/resources/js/pages/`

### Testing
- Standard: Use Vitest for component testing and Playwright for E2E. [Source: architecture/3-tech-stack.md]

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2026-01-18 | 0.1 | Initial draft for Epic 4 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
<!-- {agent_model_name_version} -->

### Debug Log References
<!-- Reference any debug logs or traces generated during development -->

### Completion Notes List
<!-- Notes about the completion of tasks and any issues encountered -->

### File List
<!-- List all files created, modified, or affected during story implementation -->

## QA Results
<!-- Results from QA Agent QA review of the completed story implementation -->